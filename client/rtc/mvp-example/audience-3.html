<!doctype html>
<html>
  <head>
    <script src="../../lib/angular/angular.js"></script>
    <script src="../rtc-normalizer.js"></script>
    <script src="../base-rtc.js"></script>
    <script src="../audience-rtc.js"></script>
    <script type="text/javascript">
      angular.module('ribbitAudienceRTC')
        .controller('audienceCtrl', function (audienceRTC) {
          audienceRTC.signalServer.onopen = function () {  //shouldn't have to mess with this here
            console.log('audience trying to connect');
            audienceRTC.getMedia({ video: true, audio: true }, function (stream) {
              var videoEl = document.getElementById('local-video');
              videoEl.src = window.URL.createObjectURL(stream);          
              audienceRTC.connect({ roomname: 'aviary', presenter: 'fred' }, 'brian');
            });
          };
        })
        .config(['baseRTCProvider', function(baseRTCProvider) {
          console.log('hey! in the config');

          baseRTCProvider.setSignalServer('ws://localhost:3434'); //normally must be set up by app

          baseRTCProvider.setPeerConnectionConfig({
            'iceServers': [
              {'url': 'stun:stun.services.mozilla.com'}, 
              {'url': 'stun:stun.l.google.com:19302'}
            ]
          });
        }]);
    </script>
  </head>
  <body ng-app="ribbitAudienceRTC" ng-controller="audienceCtrl">
    <h1>Local Video</h1>
    <video id="local-video" autoplay muted style="width:40%;"></video>
  </body>
</html>